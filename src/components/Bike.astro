---
import Card from "./Card.astro";
import CardInfo from "./CardInfo.astro";
---

<Card>
  <canvas
    id="bike"
    width="400px"
    height="400px"
    class="w-full m-auto cursor-grabbing"></canvas>
  <CardInfo text="State Machine: update scroll input" />
</Card>

<script>
  import { Rive } from "@rive-app/canvas";

  // mouse cheese
  const bike = new Rive({
    src: "animations/demo.riv",
    canvas: document.getElementById("bike"),
    artboard: "bike_spin",
    autoplay: true,
    stateMachines: "bike_scroll",
    onLoad: () => {
      bike.resizeDrawingSurfaceToCanvas();
    },
  });

  function moveBike() {
    const scrollInputs = bike.stateMachineInputs("bike_scroll");
    const pos = document.documentElement.scrollTop;
    const calcHeight =
      document.documentElement.scrollHeight -
      document.documentElement.clientHeight;
    const scrollValue = Math.round((pos * 100) / calcHeight);

    scrollInputs[0].value = scrollValue;
  }

  //TODO throttle scroll
  window.document.addEventListener("scroll", (event) => {
    moveBike();
  });
</script>
